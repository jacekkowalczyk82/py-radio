#cloud-config

package_update: true
package_upgrade: true

packages:
  - curl
  - rabbitmq-server

runcmd:
  # Enable Management Plugin
  - rabbitmq-plugins enable rabbitmq_management
  
  # Allow guest user to connect from anywhere (not just localhost)
  # By default 'guest' is restricted to loopback.
  # We create a config file to allow loopback_users = none (allow all) or just add a new user.
  # Easiest for dev is to modify loopback_users.
  - echo 'loopback_users = none' >> /etc/rabbitmq/rabbitmq.conf
  
  # Restart service to apply changes
  - systemctl restart rabbitmq-server

  # Alternatively, create a new admin user if 'guest' restriction persists or for better practice
  # - rabbitmqctl add_user admin admin
  # - rabbitmqctl set_user_tags admin administrator
  # - rabbitmqctl set_permissions -p / admin ".*" ".*" ".*"
